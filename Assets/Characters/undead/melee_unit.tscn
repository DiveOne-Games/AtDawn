[gd_scene load_steps=28 format=3 uid="uid://caebdmwfuvw6n"]

[ext_resource type="Script" uid="uid://tbs23lxrp7jb" path="res://Assets/characters/player2d.gd" id="1_iy2q1"]
[ext_resource type="Script" uid="uid://ryg4ifudumer" path="res://Assets/Scripts/velocity.gd" id="2_tqn2s"]
[ext_resource type="Script" uid="uid://psdyf3ckvdta" path="res://Assets/Scripts/behavior/character_ctrl.gd" id="3_rrwq3"]
[ext_resource type="PackedScene" uid="uid://cf2ta7mrj3mae" path="res://Assets/shared/weapon_2d.tscn" id="4_d1rke"]
[ext_resource type="Resource" uid="uid://b8w8gfudxatnf" path="res://Assets/resources/weapons/punch.tres" id="5_4xcdp"]
[ext_resource type="PackedScene" uid="uid://5tk7ooyurrrr" path="res://Assets/characters/shared/react_zone.tscn" id="6_jbqws"]
[ext_resource type="Texture2D" uid="uid://bo5b8oeaf561n" path="res://Assets/characters/Zombie/undead_sprites_all.png" id="7_2nkq2"]
[ext_resource type="Script" uid="uid://bnqmcdui30ia6" path="res://Assets/Scripts/Characters/face.gd" id="8_5f4en"]
[ext_resource type="Animation" uid="uid://d2boox1aa8pri" path="res://Assets/resources/animations/anim_undead_RESET.res" id="9_0ufsq"]
[ext_resource type="Animation" uid="uid://cdg6gs6qt3val" path="res://Assets/resources/animations/anim_undead_walk.res" id="10_uvqsj"]
[ext_resource type="Script" uid="uid://ciutknmu4ljw1" path="res://Assets/characters/hit_box.gd" id="11_lchsn"]
[ext_resource type="PackedScene" uid="uid://beeoekig70q4o" path="res://Assets/shared/behavior/behavior_machine.tscn" id="12_nunmc"]
[ext_resource type="PackedScene" uid="uid://c361obudontxu" path="res://Assets/shared/behavior/chase.tscn" id="13_eqrbe"]
[ext_resource type="PackedScene" uid="uid://cay4ak2gn22pu" path="res://Assets/shared/behavior/attack.tscn" id="14_wutlh"]
[ext_resource type="PackedScene" uid="uid://ckbbg7l31od8a" path="res://Assets/shared/behavior/idle.tscn" id="15_8shoc"]
[ext_resource type="PackedScene" uid="uid://dk4wlgy0qgxsy" path="res://Assets/shared/behavior/hurt.tscn" id="16_5tjyl"]
[ext_resource type="PackedScene" uid="uid://ctnihc2a51ncc" path="res://Assets/shared/behavior/patrol.tscn" id="17_jt5i0"]
[ext_resource type="PackedScene" uid="uid://dlf6faof3gai6" path="res://Assets/shared/behavior/death.tscn" id="18_im5a5"]

[sub_resource type="RectangleShape2D" id="RectangleShape2D_sxu3u"]
size = Vector2(20, 14)

[sub_resource type="AnimationLibrary" id="AnimationLibrary_3wt10"]
_data = {
&"RESET": ExtResource("9_0ufsq")
}

[sub_resource type="Animation" id="Animation_ducu6"]
resource_name = "attack"
length = 0.8
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.033333335, 0.06666667, 0.10000001, 0.13333334, 0.2, 0.26666668, 0.33333334, 0.4, 0.46666667, 0.53333336, 0.6, 0.6666667, 0.73333335),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 0), Vector2i(1, 0), Vector2i(2, 0), Vector2i(3, 0), Vector2i(4, 0), Vector2i(5, 0), Vector2i(6, 0), Vector2i(7, 0), Vector2i(8, 0), Vector2i(9, 0), Vector2i(10, 0), Vector2i(11, 0), Vector2i(12, 0), Vector2i(13, 0)]
}
tracks/1/type = "value"
tracks/1/imported = false
tracks/1/enabled = true
tracks/1/path = NodePath("Equipment/Weapon2D:disable_shape")
tracks/1/interp = 1
tracks/1/loop_wrap = true
tracks/1/keys = {
"times": PackedFloat32Array(0, 0.0019399691, 0.28049198, 0.5),
"transitions": PackedFloat32Array(1, 1, 1, 1),
"update": 1,
"values": [true, true, false, true]
}

[sub_resource type="Animation" id="Animation_6ixtw"]
resource_name = "dead"
length = 0.8
step = 0.033
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.06666667, 0.13333334, 0.2, 0.26666668, 0.33333334, 0.4, 0.46666667, 0.5333333, 0.6, 0.6666666, 0.73333335),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 1), Vector2i(1, 1), Vector2i(2, 1), Vector2i(3, 1), Vector2i(4, 1), Vector2i(5, 1), Vector2i(6, 1), Vector2i(7, 1), Vector2i(8, 1), Vector2i(9, 1), Vector2i(10, 1), Vector2i(11, 1)]
}

[sub_resource type="Animation" id="Animation_614bx"]
resource_name = "hurt"
length = 0.8
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.06666667, 0.13333334, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 2), Vector2i(1, 2), Vector2i(2, 2), Vector2i(3, 2), Vector2i(4, 2), Vector2i(5, 2), Vector2i(6, 2), Vector2i(7, 2), Vector2i(8, 2)]
}

[sub_resource type="Animation" id="Animation_l1spx"]
length = 0.8
loop_mode = 1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 3), Vector2i(1, 3), Vector2i(2, 3), Vector2i(3, 3), Vector2i(4, 3), Vector2i(5, 3), Vector2i(6, 3), Vector2i(7, 3)]
}

[sub_resource type="Animation" id="Animation_e0lwe"]
resource_name = "idle2"
length = 0.8
step = 0.1
tracks/0/type = "value"
tracks/0/imported = false
tracks/0/enabled = true
tracks/0/path = NodePath("Sprite2D:frame_coords")
tracks/0/interp = 1
tracks/0/loop_wrap = true
tracks/0/keys = {
"times": PackedFloat32Array(0, 0.1, 0.2, 0.3, 0.4, 0.5, 0.6, 0.7),
"transitions": PackedFloat32Array(1, 1, 1, 1, 1, 1, 1, 1),
"update": 1,
"values": [Vector2i(0, 4), Vector2i(1, 4), Vector2i(2, 4), Vector2i(3, 4), Vector2i(4, 4), Vector2i(5, 4), Vector2i(6, 4), Vector2i(7, 4)]
}

[sub_resource type="AnimationLibrary" id="AnimationLibrary_grklj"]
_data = {
&"attack": SubResource("Animation_ducu6"),
&"dead": SubResource("Animation_6ixtw"),
&"hurt": SubResource("Animation_614bx"),
&"idle": SubResource("Animation_l1spx"),
&"idle2": SubResource("Animation_e0lwe"),
&"walk": ExtResource("10_uvqsj")
}

[sub_resource type="CapsuleShape2D" id="CapsuleShape2D_614bx"]
height = 44.0

[node name="MeleeUnit" type="CharacterBody2D" groups=["enemies", "undead"]]
collision_mask = 18
script = ExtResource("1_iy2q1")

[node name="CollisionShape2D" type="CollisionShape2D" parent="."]
position = Vector2(-1, 18)
shape = SubResource("RectangleShape2D_sxu3u")

[node name="Velocity" type="Node" parent="." node_paths=PackedStringArray("character")]
script = ExtResource("2_tqn2s")
character = NodePath("..")

[node name="MotionController" type="Node" parent="." node_paths=PackedStringArray("character")]
script = ExtResource("3_rrwq3")
character = NodePath("..")

[node name="Equipment" type="Node2D" parent="."]
unique_name_in_owner = true

[node name="Weapon2D" parent="Equipment" instance=ExtResource("4_d1rke")]
position = Vector2(-5, -3)
collision_layer = 33
collision_mask = 2
item = ExtResource("5_4xcdp")

[node name="ReactZone" parent="." node_paths=PackedStringArray("character") instance=ExtResource("6_jbqws")]
character = NodePath("..")

[node name="Sprite2D" type="Sprite2D" parent="."]
unique_name_in_owner = true
texture = ExtResource("7_2nkq2")
hframes = 18
vframes = 6
script = ExtResource("8_5f4en")

[node name="AnimationPlayer" type="AnimationPlayer" parent="."]
unique_name_in_owner = true
libraries = {
&"": SubResource("AnimationLibrary_3wt10"),
&"undead": SubResource("AnimationLibrary_grklj")
}

[node name="AudioStreamPlayer2D" type="AudioStreamPlayer2D" parent="."]

[node name="HitBox" type="Area2D" parent="." node_paths=PackedStringArray("character")]
collision_layer = 33
collision_mask = 2
script = ExtResource("11_lchsn")
character = NodePath("..")

[node name="CollisionShape2D" type="CollisionShape2D" parent="HitBox"]
shape = SubResource("CapsuleShape2D_614bx")

[node name="BehaviorMachine" parent="." node_paths=PackedStringArray("initial_state", "hurt", "death") instance=ExtResource("12_nunmc")]
initial_state = NodePath("Idle")
hurt = NodePath("Hurt")
death = NodePath("Death")

[node name="Chase" parent="BehaviorMachine" node_paths=PackedStringArray("idle") instance=ExtResource("13_eqrbe")]
idle = NodePath("../Idle")

[node name="Attack" parent="BehaviorMachine" node_paths=PackedStringArray("idle") instance=ExtResource("14_wutlh")]
idle = NodePath("../Idle")

[node name="Idle" parent="BehaviorMachine" node_paths=PackedStringArray("attack", "patrol") instance=ExtResource("15_8shoc")]
attack = NodePath("../Attack")
patrol = NodePath("../Patrol")

[node name="Hurt" parent="BehaviorMachine" node_paths=PackedStringArray("idle", "death") instance=ExtResource("16_5tjyl")]
idle = NodePath("../Idle")
death = NodePath("../Death")

[node name="Patrol" parent="BehaviorMachine" node_paths=PackedStringArray("chase", "idle") instance=ExtResource("17_jt5i0")]
chase = NodePath("../Chase")
idle = NodePath("../Idle")

[node name="Death" parent="BehaviorMachine" instance=ExtResource("18_im5a5")]

[connection signal="velocity_changed" from="Velocity" to="Sprite2D" method="_on_velocity_changed"]
[connection signal="target_updated" from="ReactZone" to="." method="_on_react_zone_target_updated"]
[connection signal="area_shape_entered" from="HitBox" to="HitBox" method="_on_area_shape_entered"]

[editable path="ReactZone"]
